<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AirSentinel - Air Quality Monitor</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå´Ô∏è</text></svg>">
    <script src="script.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Connection Setup Modal -->
    <div id="setupModal" class="modal">
        <div class="modal-content setup-modal">
            <div class="setup-header">
                <div class="setup-icon">
                    <i class="fas fa-wifi"></i>
                </div>
                <h2>Connect to AirSentinel</h2>
                <p>Follow these steps to connect to your device</p>
            </div>
            
            <div class="setup-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Connect to WiFi</h3>
                        <p>Go to your device's WiFi settings and connect to:</p>
                        <div class="wifi-info">
                            <strong>Network:</strong> <span id="wifiSsid">AirSentinel</span><br>
                            <strong>Password:</strong> <span id="wifiPassword">1234567890</span>
                        </div>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Keep this page open</h3>
                        <p>Don't close this browser tab. It will automatically detect your device.</p>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Wait for connection</h3>
                        <p>The system will automatically connect to your AirSentinel device.</p>
                        <div class="connection-status" id="modalConnectionStatus">
                            <i class="fas fa-circle-notch fa-spin"></i> Searching for device...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="setup-actions">
                <button class="btn btn-primary" onclick="checkConnection()">
                    <i class="fas fa-sync-alt"></i> Check Connection Now
                </button>
                <button class="btn btn-secondary" onclick="hideSetupModal()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            
            <div class="setup-qrcode">
                <div id="qrCodeContainer"></div>
                <p>Scan to view WiFi credentials</p>
            </div>
        </div>
    </div>

    <!-- Disconnected Overlay -->
    <div id="disconnectedOverlay" class="overlay">
        <div class="overlay-content">
            <div class="overlay-icon">
                <i class="fas fa-unlink"></i>
            </div>
            <h2>Device Disconnected</h2>
            <p>Your device is no longer connected to AirSentinel WiFi.</p>
            <p>Please reconnect to the "AirSentinel" network.</p>
            <button class="btn btn-primary" onclick="showSetupModal()">
                <i class="fas fa-wifi"></i> Show Connection Instructions
            </button>
        </div>
    </div>

    <!-- Device Settings Modal -->
    <div id="deviceSettingsModal" class="modal">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h2>Device Settings</h2>
                <button class="btn-close" onclick="hideDeviceSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="settings-group">
                    <label for="deviceIpInput">Device IP Address:</label>
                    <div class="input-group">
                        <input type="text" id="deviceIpInput" placeholder="192.168.4.1" value="192.168.4.1">
                        <button class="btn btn-secondary" onclick="updateDeviceIP()">Save</button>
                    </div>
                    <small>Local network IP (e.g., 192.168.x.x)</small>
                </div>
                
                <div class="settings-group">
                    <label for="connectionModeSelect">Connection Mode:</label>
                    <select id="connectionModeSelect" onchange="updateConnectionMode()">
                        <option value="local">Local WiFi (Same network)</option>
                        <option value="cloud">Cloud Proxy (Remote access)</option>
                        <option value="auto">Auto-detect (Try local first)</option>
                    </select>
                    <small id="modeDescription">Connect to the same WiFi network as ESP32</small>
                </div>
                
                <div class="settings-group">
                    <label>Current Connection:</label>
                    <div class="status-display">
                        <div><strong>Mode:</strong> <span id="currentMode">local</span></div>
                        <div><strong>Device IP:</strong> <span id="currentIP">192.168.4.1</span></div>
                        <div><strong>Status:</strong> <span id="currentStatus">Disconnected</span></div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <label>Quick Tips:</label>
                    <ul class="tips-list">
                        <li><strong>Local Mode:</strong> Device and website must be on same WiFi network</li>
                        <li><strong>Cloud Mode:</strong> Works remotely but requires cloud proxy</li>
                        <li><strong>Auto Mode:</strong> Tries local first, falls back to cloud</li>
                    </ul>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="testConnection()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <button class="btn btn-secondary" onclick="hideDeviceSettingsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Sensor Detail Modals -->
    <div id="temperatureModal" class="modal">
        <div class="modal-content sensor-modal">
            <div class="modal-header">
                <h2><i class="fas fa-thermometer-half"></i> Temperature</h2>
                <button class="btn-close" onclick="hideTemperatureModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="sensor-detail-content">
                    <div class="sensor-value-display">
                        <span class="value" id="modalTemperature">--</span>
                        <span class="unit">¬∞C</span>
                    </div>
                    <div class="sensor-info">
                        <h3><i class="fas fa-info-circle"></i> Role in the System</h3>
                        <p>Temperature monitoring is crucial for:</p>
                        <ul>
                            <li><strong>Comfort Assessment:</strong> Ideal indoor temperature ranges from 20-25¬∞C</li>
                            <li><strong>Health Impact:</strong> Affects respiratory function and overall comfort</li>
                            <li><strong>System Calibration:</strong> Temperature affects sensor readings accuracy</li>
                            <li><strong>Energy Efficiency:</strong> Helps optimize HVAC system performance</li>
                        </ul>
                        
                        <h3><i class="fas fa-chart-line"></i> Health Implications</h3>
                        <ul>
                            <li><strong>Optimal:</strong> 20-25¬∞C (Comfortable for most activities)</li>
                            <li><strong>Too Cold:</strong> <20¬∞C (Risk of respiratory issues)</li>
                            <li><strong>Too Hot:</strong> >25¬∞C (Can cause dehydration, fatigue)</li>
                            <li><strong>Dangerous:</strong> <15¬∞C or >30¬∞C (Health risks increase significantly)</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideTemperatureModal()">Close</button>
            </div>
        </div>
    </div>

    <div id="humidityModal" class="modal">
        <div class="modal-content sensor-modal">
            <div class="modal-header">
                <h2><i class="fas fa-tint"></i> Humidity</h2>
                <button class="btn-close" onclick="hideHumidityModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="sensor-detail-content">
                    <div class="sensor-value-display">
                        <span class="value" id="modalHumidity">--</span>
                        <span class="unit">%</span>
                    </div>
                    <div class="sensor-info">
                        <h3><i class="fas fa-info-circle"></i> Role in the System</h3>
                        <p>Humidity monitoring is essential for:</p>
                        <ul>
                            <li><strong>Comfort Level:</strong> Affects how hot or cold we feel</li>
                            <li><strong>Health Protection:</strong> Prevents mold growth and respiratory issues</li>
                            <li><strong>Sensor Accuracy:</strong> Humidity affects gas sensor readings</li>
                            <li><strong>Indoor Climate:</strong> Maintains optimal living/working conditions</li>
                        </ul>
                        
                        <h3><i class="fas fa-chart-line"></i> Health Implications</h3>
                        <ul>
                            <li><strong>Optimal:</strong> 40-60% (Comfortable, reduces pathogens)</li>
                            <li><strong>Too Dry:</strong> <30% (Dry skin, respiratory irritation)</li>
                            <li><strong>Too Humid:</strong> >60% (Mold growth, dust mites)</li>
                            <li><strong>Extreme:</strong> <20% or >80% (Health hazards present)</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideHumidityModal()">Close</button>
            </div>
        </div>
    </div>

    <div id="airQualityModal" class="modal">
        <div class="modal-content sensor-modal">
            <div class="modal-header">
                <h2><i class="fas fa-wind"></i> Air Quality (VOC/PPM)</h2>
                <button class="btn-close" onclick="hideAirQualityModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="sensor-detail-content">
                    <div class="sensor-value-display">
                        <span class="value" id="modalAirQuality">--</span>
                        <span class="unit">PPM</span>
                    </div>
                    <div class="sensor-info">
                        <h3><i class="fas fa-info-circle"></i> Role in the System</h3>
                        <p>Air quality monitoring detects:</p>
                        <ul>
                            <li><strong>VOCs:</strong> Volatile Organic Compounds from cleaning products, paints, furniture</li>
                            <li><strong>Toxins:</strong> Harmful gases and pollutants</li>
                            <li><strong>Indoor Pollution:</strong> Particles from cooking, smoking, etc.</li>
                            <li><strong>Ventilation Need:</strong> Indicates when fresh air is required</li>
                        </ul>
                        
                        <h3><i class="fas fa-chart-line"></i> Health Implications</h3>
                        <ul>
                            <li><strong>Excellent:</strong> 0-50 PPM (Ideal indoor air)</li>
                            <li><strong>Moderate:</strong> 51-100 PPM (Adequate, monitor)</li>
                            <li><strong>Unhealthy:</strong> 101-200 PPM (Improve ventilation)</li>
                            <li><strong>Hazardous:</strong> 201+ PPM (Immediate action needed)</li>
                        </ul>
                        
                        <div class="health-tips">
                            <h3><i class="fas fa-lightbulb"></i> Improvement Tips</h3>
                            <ul>
                                <li>Increase ventilation by opening windows</li>
                                <li>Use air purifiers with HEPA filters</li>
                                <li>Reduce use of aerosol products</li>
                                <li>Regularly maintain HVAC systems</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideAirQualityModal()">Close</button>
            </div>
        </div>
    </div>

    <div id="co2Modal" class="modal">
        <div class="modal-content sensor-modal">
            <div class="modal-header">
                <h2><i class="fas fa-cloud"></i> CO‚ÇÇ Level</h2>
                <button class="btn-close" onclick="hideCO2Modal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="sensor-detail-content">
                    <div class="sensor-value-display">
                        <span class="value" id="modalCO2">--</span>
                        <span class="unit">PPM</span>
                    </div>
                    <div class="sensor-info">
                        <h3><i class="fas fa-info-circle"></i> Role in the System</h3>
                        <p>CO‚ÇÇ monitoring indicates:</p>
                        <ul>
                            <li><strong>Ventilation Quality:</strong> Measures fresh air exchange</li>
                            <li><strong>Occupancy Level:</strong> Higher CO‚ÇÇ means more people breathing</li>
                            <li><strong>Air Stagnation:</strong> Shows when indoor air is not circulating</li>
                            <li><strong>Health Risk:</strong> High CO‚ÇÇ affects cognitive function</li>
                        </ul>
                        
                        <h3><i class="fas fa-chart-line"></i> Health Implications</h3>
                        <ul>
                            <li><strong>Excellent:</strong> 400-600 PPM (Outdoor air level)</li>
                            <li><strong>Good:</strong> 601-800 PPM (Well-ventilated indoor)</li>
                            <li><strong>Fair:</strong> 801-1000 PPM (Complaints may arise)</li>
                            <li><strong>Poor:</strong> 1001-1400 PPM (Drowsiness, poor concentration)</li>
                            <li><strong>Unhealthy:</strong> 1400+ PPM (Headaches, sleepiness)</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideCO2Modal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Assistance Popup -->
    <div id="assistancePopup" class="assistance-popup">
        <div class="popup-content">
            <div class="popup-header">
                <h3><i class="fas fa-question-circle"></i> Need Assistance?</h3>
                <button class="btn-close" onclick="hideAssistancePopup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <p>Our AI assistant can help you with:</p>
                <ul>
                    <li><i class="fas fa-heartbeat"></i> Health recommendations</li>
                    <li><i class="fas fa-chart-line"></i> Data interpretation</li>
                    <li><i class="fas fa-cogs"></i> Device troubleshooting</li>
                    <li><i class="fas fa-tips"></i> Improvement tips</li>
                </ul>
                <button class="btn btn-primary" onclick="showAssistancePopupChatbot()">
                    <i class="fas fa-robot"></i> Open AI Assistant
                </button>
            </div>
        </div>
    </div>



    <!-- Main Container -->
    <div class="container">
        <!-- Header with Connection Status -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-wind"></i>
                    </div>
                    <div class="logo-text">AirSentinel</div>
                </div>
                <div class="connection-indicator" id="connectionIndicator">
                    <span class="indicator-dot"></span>
                    <span id="connectionText">Connecting...</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-icon" onclick="showDeviceSettingsModal()" title="Device Settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn btn-icon" onclick="showSetupModal()" title="Connection Help">
                    <i class="fas fa-wifi"></i>
                </button>
                <button class="btn btn-icon" onclick="refreshData()" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn btn-icon" onclick="toggleTheme()" title="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
        
        <!-- Location Display -->
        <div class="location-section">
            <div class="location-info">
                <i class="fas fa-map-marker-alt"></i>
                <span id="locationText">Getting location...</span>
                <button class="btn btn-small" onclick="updateLocation()" title="Update Location">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
            <div class="location-coords">
                <span id="coordinates">Lat: --, Lon: --</span>
                <span id="lastUpdate">Last updated: --</span>
            </div>
        </div>
        
        <!-- Main Dashboard Cards -->
        <div class="dashboard">
            <!-- Temperature Card -->
            <div class="card temperature-card clickable-card" onclick="showTemperatureModal()">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-thermometer-half"></i> Temperature
                    </div>
                    <div class="card-actions">
                        <button class="btn-icon-small" onclick="setLCDMode('temperature')" title="Show on LCD">
                            <i class="fas fa-tv"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="card-value" id="temperature">--</div>
                    <div class="card-unit">¬∞C</div>
                </div>
                <div class="card-footer">
                    <div class="card-time" id="tempTime">--:--:--</div>
                    <div class="card-hint">Tap for details</div>
                </div>
            </div>
            
            <!-- Humidity Card -->
            <div class="card humidity-card clickable-card" onclick="showHumidityModal()">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-tint"></i> Humidity
                    </div>
                    <div class="card-actions">
                        <button class="btn-icon-small" onclick="setLCDMode('humidity')" title="Show on LCD">
                            <i class="fas fa-tv"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="card-value" id="humidity">--</div>
                    <div class="card-unit">%</div>
                </div>
                <div class="card-footer">
                    <div class="card-time" id="humTime">--:--:--</div>
                    <div class="card-hint">Tap for details</div>
                </div>
            </div>
            
            <!-- Air Quality Card -->
            <div class="card airquality-card clickable-card" onclick="showAirQualityModal()">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-wind"></i> Air Quality
                    </div>
                    <div class="card-actions">
                        <button class="btn-icon-small" onclick="setLCDMode('airquality')" title="Show on LCD">
                            <i class="fas fa-tv"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="card-value" id="airQuality">--</div>
                    <div class="card-unit">PPM</div>
                </div>
                <div class="card-footer">
                    <div class="aqi-indicator">
                        <div class="aqi-dot" id="aqiDot"></div>
                        <span class="aqi-label" id="aqiLabel">Good</span>
                    </div>
                    <div class="card-hint">Tap for details</div>
                </div>
            </div>
            
            <!-- CO‚ÇÇ Level Card -->
            <div class="card co2-card clickable-card" onclick="showCO2Modal()">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-cloud"></i> CO‚ÇÇ Level
                    </div>
                    <div class="card-actions">
                        <button class="btn-icon-small" onclick="setLCDMode('co2')" title="Show on LCD">
                            <i class="fas fa-tv"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="card-value" id="co2Level">--</div>
                    <div class="card-unit">PPM</div>
                </div>
                <div class="card-footer">
                    <div class="card-time" id="co2Time">--:--:--</div>
                    <div class="card-hint">Tap for details</div>
                </div>
            </div>
        </div>
        
        <!-- Air Quality Gauge -->
        <div class="section">
            <div class="section-header">
                <h3><i class="fas fa-chart-line"></i> Air Quality Index</h3>
                <div class="section-actions">
                    <button class="btn btn-small" onclick="calibrateSensor()">
                        <i class="fas fa-cog"></i> Calibrate
                    </button>
                </div>
            </div>
            <div class="gauge-container">
                <div class="gauge">
                    <div class="gauge-marker" id="gaugeMarker"></div>
                </div>
                <div class="gauge-labels">
                    <span>Good</span>
                    <span>Moderate</span>
                    <span>Unhealthy</span>
                    <span>Hazardous</span>
                </div>
            </div>
        </div>
        
        <!-- LCD Control Section -->
        <div class="section">
            <div class="section-header">
                <h3><i class="fas fa-tv"></i> LCD Display Control</h3>
            </div>
            <div class="lcd-controls">
                <div class="lcd-buttons">
                    <button class="lcd-btn" onclick="setLCDMode('welcome')">
                        <i class="fas fa-home"></i> Welcome
                    </button>
                    <button class="lcd-btn" onclick="setLCDMode('temperature')">
                        <i class="fas fa-thermometer-half"></i> Temperature
                    </button>
                    <button class="lcd-btn" onclick="setLCDMode('humidity')">
                        <i class="fas fa-tint"></i> Humidity
                    </button>
                    <button class="lcd-btn" onclick="setLCDMode('airquality')">
                        <i class="fas fa-wind"></i> Air Quality
                    </button>
                    <button class="lcd-btn" onclick="setLCDMode('co2')">
                        <i class="fas fa-cloud"></i> CO‚ÇÇ
                    </button>
                    <button class="lcd-btn" onclick="setLCDMode('alldata')">
                        <i class="fas fa-chart-bar"></i> All Data
                    </button>
                </div>
                <div class="lcd-info">
                    <i class="fas fa-info-circle"></i>
                    Current LCD Display: <strong id="currentLCDDisplay">Welcome Screen</strong>
                </div>
            </div>
        </div>
        
        <!-- Charts Section -->
        <div class="section">
            <div class="section-header">
                <h3><i class="fas fa-chart-bar"></i> Sensor History</h3>
                <div class="chart-tabs">
                    <button class="chart-tab active" onclick="switchChart('temperature')">
                        <i class="fas fa-thermometer-half"></i> Temperature
                    </button>
                    <button class="chart-tab" onclick="switchChart('humidity')">
                        <i class="fas fa-tint"></i> Humidity
                    </button>
                    <button class="chart-tab" onclick="switchChart('airquality')">
                        <i class="fas fa-wind"></i> Air Quality
                    </button>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-wrapper" id="temperatureChart">
                    <div class="chart" id="temperatureBars"></div>
                    <div class="chart-axis"></div>
                </div>
                <div class="chart-wrapper" id="humidityChart" style="display: none;">
                    <div class="chart" id="humidityBars"></div>
                    <div class="chart-axis"></div>
                </div>
                <div class="chart-wrapper" id="airqualityChart" style="display: none;">
                    <div class="chart" id="airqualityBars"></div>
                    <div class="chart-axis"></div>
                </div>
            </div>
        </div>
        
        <!-- Device Controls -->
        <div class="section">
            <div class="section-header">
                <h3><i class="fas fa-sliders-h"></i> Device Controls</h3>
            </div>
            <div class="controls-grid">
                <div class="control-card">
                    <div class="control-header">
                        <i class="fas fa-lightbulb"></i>
                        <h4>Built-in LED</h4>
                    </div>
                    <div class="control-content">
                        <div class="led-status">
                            <div class="led-indicator" id="ledIndicator"></div>
                            <span>Status: <strong id="ledStatusText">OFF</strong></span>
                        </div>
                        <button class="btn btn-control" onclick="toggleLED()">
                            <i class="fas fa-power-off"></i> Toggle LED
                        </button>
                    </div>
                </div>
                
                <div class="control-card">
                    <div class="control-header">
                        <i class="fas fa-cogs"></i>
                        <h4>Sensor Calibration</h4>
                    </div>
                    <div class="control-content">
                        <p>Calibrate MQ-135 sensor in clean air (takes 30 seconds)</p>
                        <button class="btn btn-control btn-warning" onclick="calibrateSensor()">
                            <i class="fas fa-cog"></i> Start Calibration
                        </button>
                    </div>
                </div>
                
                <div class="control-card">
                    <div class="control-header">
                        <i class="fas fa-sync-alt"></i>
                        <h4>System Refresh</h4>
                    </div>
                    <div class="control-content">
                        <p>Force refresh all sensor readings</p>
                        <button class="btn btn-control" onclick="refreshData()">
                            <i class="fas fa-redo"></i> Refresh All
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="section">
            <div class="section-header">
                <h3><i class="fas fa-info-circle"></i> System Status</h3>
            </div>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="status-content">
                        <div class="status-label">Uptime</div>
                        <div class="status-value" id="uptime">00:00:00</div>
                    </div>
                </div>
                
                <div class="status-item">
                    <div class="status-icon">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <div class="status-content">
                        <div class="status-label">Memory</div>
                        <div class="status-value" id="freeHeap">0 KB</div>
                    </div>
                </div>
                
                <div class="status-item">
                    <div class="status-icon">
                        <i class="fas fa-wifi"></i>
                    </div>
                    <div class="status-content">
                        <div class="status-label">WiFi Clients</div>
                        <div class="status-value" id="connectedClients">0</div>
                    </div>
                </div>
                
                <div class="status-item">
                    <div class="status-icon">
                        <i class="fas fa-signal"></i>
                    </div>
                    <div class="status-content">
                        <div class="status-label">Analog Raw</div>
                        <div class="status-value" id="analogRaw">0</div>
                    </div>
                </div>
                
                <div class="status-item">
                    <div class="status-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="status-content">
                        <div class="status-label">Device Ready</div>
                        <div class="status-value" id="deviceReady">No</div>
                    </div>
                </div>
                
                <div class="status-item">
                    <div class="status-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="status-content">
                        <div class="status-label">Sensor Status</div>
                        <div class="status-value" id="sensorStatus">--</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div class="footer-content">
                <div class="footer-info">
                    <div class="footer-logo">
                        <i class="fas fa-wind"></i> AirSentinel
                    </div>
                    <div class="footer-text">
                        Air Quality Monitoring System with ESP32
                    </div>
                </div>
                <div class="footer-stats">
                    <div class="footer-stat">
                        <i class="fas fa-sync-alt"></i>
                        <span>Updated: <span id="lastUpdateTime">--:--:--</span></span>
                    </div>
                    <div class="footer-stat">
                        <i class="fas fa-server"></i>
                        <span>IP: <span id="deviceIP">192.168.4.1</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Flowise Chatbot Integration - Updated -->
    <script type="module">
        import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"
        
        let flowiseChatbot = null;
        
        window.initializeFlowiseChatbot = function() {
            console.log('üöÄ Initializing Flowise chatbot...');
            
            // Initialize Flowise chatbot with auto-popup
            Chatbot.init({
                chatflowid: "92c06451-fc3a-4efe-9607-53ab51f3452f",
                apiHost: "https://cloud.flowiseai.com",
                theme: {
                    button: {
                        backgroundColor: '#00b4d8',
                        right: 20,
                        bottom: 20,
                        size: 'large'
                    },
                    chatWindow: {
                        showTitle: true,
                        title: 'AirSentinel AI Health Assistant',
                        titleAvatarSrc: 'https://cdn-icons-png.flaticon.com/512/4712/4712027.png',
                        welcomeMessage: 'üëã Hello! I\'m your AirSentinel Health Assistant. I can help you understand your air quality data and provide personalized health recommendations. How can I assist you today?',
                        backgroundColor: '#ffffff',
                        height: '500px',
                        width: '350px',
                        fontSize: '14px',
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        borderRadius: '12px',
                        boxShadow: '0 10px 40px rgba(0, 0, 0, 0.2)',
                        botMessage: {
                            backgroundColor: '#f0f7ff',
                            textColor: '#1a237e',
                            showAvatar: true,
                            avatarSrc: 'https://cdn-icons-png.flaticon.com/512/4712/4712027.png'
                        },
                        userMessage: {
                            backgroundColor: '#00b4d8',
                            textColor: '#ffffff',
                            showAvatar: true,
                            avatarSrc: 'https://cdn-icons-png.flaticon.com/512/847/847969.png'
                        },
                        textInput: {
                            placeholder: 'Ask about air quality, health tips, or sensor data...',
                            backgroundColor: '#ffffff',
                            textColor: '#303235',
                            sendButtonColor: '#00b4d8'
                        },
                        footer: {
                            textColor: '#666',
                            text: 'Powered by:',
                            company: 'AirSentinel',
                            companyLink: '#'
                        }
                    }
                }
            }).then((chatbot) => {
                flowiseChatbot = chatbot;
                console.log('‚úÖ Flowise chatbot initialized');
                
                // Auto open the chatbot after a short delay
                setTimeout(() => {
                    console.log('üîì Auto-opening chatbot...');
                    // Force open the chatbot
                    const flowiseButton = document.querySelector('.flowise-chat-button');
                    if (flowiseButton) {
                        flowiseButton.click();
                        console.log('üéâ Chatbot opened successfully');
                        
                        // Add sensor data context after opening
                        if (window.currentSensorData) {
                            const sensorData = window.currentSensorData;
                            console.log('üìä Sending sensor data context to chatbot:', sensorData);
                        }
                    }
                }, 2000);
                
            }).catch((error) => {
                console.error('‚ùå Failed to initialize Flowise chatbot:', error);
            });
        };
        
        // Cleanup function
        window.cleanupFlowiseChatbot = function() {
            if (flowiseChatbot) {
                flowiseChatbot = null;
            }
        };
        
        // Initialize chatbot when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Flowise after a short delay to ensure everything is loaded
            setTimeout(() => {
                if (typeof initializeFlowiseChatbot === 'function') {
                    initializeFlowiseChatbot();
                }
            }, 1000);
        });
    </script>
    
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</body>
</html>